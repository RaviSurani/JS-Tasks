<!DOCTYPE html>
<html data-test-id="brave-new-tab-page" dir="ltr">

<head>
    <title>Todo Task</title>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

    <!-- <script src="script.js"></script> -->
    <link rel="stylesheet" href="style.css">

</head>

<body>
    <div class="center container">
        <div class="card">
            <div class="card-header">
                <h3>Things To Do</h3>
            </div>
            <div class="card-body">
                <div class="row hide" id="maininputDiv">
                    <input type="text" class=" col-11" id="maininput"> <button onclick="hideInput()" class="col-1 btn btn-light"><i class="bi bi-x-square"></i></button></div>
                <table id="itemtable" class="table"></table>
                <div class="row">
                    <div class="col-2">
                        <button class="btn btn-light" id="addNew" onclick="showInput('Enter Name Here.')"><i
                                class="bi bi-plus-lg"></i></button>
                        <button class="btn btn-light" id="search" onclick="showInput('Search Here.')"><i
                                class="bi bi-search"></i></button>

                    </div>

                    <select id="btnaction" class="col-2" onchange="actionList(this.value)">
                        <option value="0" disabled selected>Action</option>
                        <option value="1">Select All</option>
                        <option value="2">Delete Selected</option>
                        <option value="3">Delete All</option>
                    </select>
                    <div class="col-2">
                        Total Records : <span id="totalSpan"></span>
                    </div>
                    <select id="btnSort" class="col-2" onchange="sortList(this.value)">
                        <option value="0" disabled selected>Sort</option>
                        <option value="1">Name A To Z</option>
                        <option value="2">Name Z To A</option>
                        <option value="3">Time Ascending</option>
                        <option value="4">Time Descending</option>
                    </select>
                    <div class="col-3">
                        <button class="btn " id="show1" onclick="showActive(2)">All</button>
                        <button class="btn " id="show2" onclick="showActive(1)">Active</button>
                        <button class="btn " id="show3" onclick="showActive(0)">Completed</button>
                    </div>
                </div>


            </div>
        </div>
    </div>

</body>
<script>
    let = [];
    let filter = {
        sort: 1,
        show: 2,
    };

    (function() {
        if (localStorage.getItem('todoList') != null && localStorage.getItem('todoList') != '') {
            list = JSON.parse(localStorage.todoList);
        } else {
            localStorage.setItem('todoList', JSON.stringify(list))
        }
        // sortList(filter.sort);
        // showActive(filter.show);
        setUl(list);
    })();

    function getCurrentDate() {
        return new Date().toLocaleString();
    }

    function editItem(id) {
        document.getElementById('td' + id).classList.toggle('hide')
        document.getElementById('div' + id).classList.toggle('hide')
    }

    function update(id) {
        list[id] = document.getElementById('item' + id).value;
        localList();
        setUl(list);
    }

    function removeItem(id) {
        list.splice(id, 1);
        updateLocalList();
        setUl(list);
    }

    function updateLocalList() {
        localStorage.setItem('todoList', JSON.stringify(list))
        list = JSON.parse(localStorage.todoList);
        // sortList(filter.sort);
        // showActive(filter.show);
        setUl(list);
    }

    function setUl(showList) {
        let html = '';

        if (filter.sort == 1) {
            showList.sort((a, b) => (a.name > b.name) ? 1 : -1);
            document.getElementById('btnSort').value = filter.sort;
        } else if (filter.sort == 2) {
            showList.reverse((a, b) => (a.name > b.name) ? 1 : -1);
            document.getElementById('btnSort').value = filter.sort;
        } else if (filter.sort == 3) {
            showList.sort((a, b) => (a.tiem > b.time) ? 1 : -1);
            document.getElementById('btnSort').value = filter.sort;
        } else if (filter.sort == 4) {
            showList.reverse((a, b) => (a.tiem > b.time) ? 1 : -1);
            document.getElementById('btnSort').value = filter.sort;
        }
        let showall = false;
        if (filter.show == 2) {
            showall = true;
        }
        showList.forEach(function(item, index) {
            if (filter.show == item.status || showall) {
                html += '<tr>';
                if (item.name == 'No Record Found.') {
                    html += `<td>No Record Found.</td>`;
                } else {

                    html += `<td class='tdCheckbox'><input type="checkbox" class="editRecord" value="${index}" onchange="setActive(${index})" ${item.status == '0' ? 'checked' : ''}></td>
                    <td class='hide' id=${'div' + index}>  <input type="text" id="item${index}" value='${item.name}' class='editnput'> <button onclick='update(${index})'>Edit</button></td>
                    <td class='itemName ${item.status != '1' ? 'overLine' : ''}' id='td${index}'>${item.name}</td>
                    <td class='itemName' >${item.time}</td>
                    <td class='row d-flex justify-content-end margin10'>
                        <button class="btn btn-info col-2" onclick='editItem(${index})'><span class="bi bi-pen"></span></button>
                        <button class="btn btn-danger col-2" onclick='removeItem(${index})'><i class="bi bi-x-square"></i></button>
                    </td>`
                }
                html += '</tr> ';
            }
        })

        if (filter.show == 2) {
            document.getElementById('show1').classList.add('btn-primary');
            document.getElementById('show2').classList.remove('btn-primary');
            document.getElementById('show3').classList.remove('btn-primary');
        } else if (filter.show == 1) {
            document.getElementById('show2').classList.add('btn-primary');
            document.getElementById('show1').classList.remove('btn-primary');
            document.getElementById('show3').classList.remove('btn-primary');
        } else if (filter.show == 0) {
            document.getElementById('show3').classList.add('btn-primary');
            document.getElementById('show1').classList.remove('btn-primary');
            document.getElementById('show2').classList.remove('btn-primary');
        }
        document.getElementById('itemtable').innerHTML = html;
        document.getElementById('totalSpan').innerText = showList.length;

    }

    document.getElementById("maininput").addEventListener("keyup", function(event) {
        if (event.keyCode === 13) {
            addnew()
        } else {
            let inputval = document.getElementById('maininput').value;
            let newList = [];
            list.forEach(function(item, index) {
                if (item.name.indexOf(inputval) != -1) {
                    newList.push({
                        name: item.name,
                        time: item.time,
                        status: item.status,
                    })
                }
            });
            if (!newList.length) {
                newList.push({
                    name: 'No Record Found.',
                    time: '',
                    status: '1',
                });
            }
            setUl(newList);
        }

    });

    function addnew() {
        let newitem = document.getElementById('maininput').value;
        if (!list.length) {
            list.push({
                name: newitem,
                time: getCurrentDate(),
                status: '1',
            });
        } else {
            inList = false;
            list.forEach(function(item) {
                if (!item.name != newitem) {
                    inList = true;
                }
            })

            if (inList) {
                list.push({
                    name: newitem,
                    time: getCurrentDate(),
                    status: '1',
                });
            } else {
                alert('Allrady in List')
            }
        }
        updateLocalList();
        // setUl(list);
        hideInput();
    }

    function sortList(id) {
        // if (id == 1) {
        //     list.sort((a, b) => (a.name > b.name) ? 1 : -1);
        // } else if (id == 2) {
        //     list.reverse((a, b) => (a.name > b.name) ? 1 : -1);
        // } else if (id == 3) {
        //     list.sort((a, b) => (a.tiem > b.time) ? 1 : -1);
        // } else if (id == 4) {
        //     list.reverse((a, b) => (a.tiem > b.time) ? 1 : -1);
        // }
        filter.sort = id;
        setUl(list);
    }

    function setActive(id) {
        if (list[id].status == '1') {
            list[id].status = '0'
        } else {
            list[id].status = '1'
        }
        updateLocalList()
    }

    function showActive(id = 2) {
        filter.show = id;
        setUl(list);


    }

    function showInput(hint) {
        document.getElementById('maininput').placeholder = hint
        document.getElementById('maininputDiv').classList.remove('hide')
    }

    function hideInput() {
        document.getElementById('maininput').value = '';
        document.getElementById('maininputDiv').classList.add('hide')
    }

    function actionList(id) {
        if (id == 1) {
            check = document.querySelectorAll('input[type=checkbox]');
            check.forEach(function(checkbox) {
                checkbox.checked = true;
            })
        } else if (id == 2) {
            check = document.querySelectorAll('input[type=checkbox]:checked');
            check.forEach(function(checkbox) {
                list.splice(checkbox.value, 1);
            });
            updateLocalList();
        } else if (id == 3) {
            list = [];
            updateLocalList();
        }
    }
</script>

</html>