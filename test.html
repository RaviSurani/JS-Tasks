<!DOCTYPE html>
<html data-test-id="brave-new-tab-page" dir="ltr">

<head>
    <title>Todo Task</title>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

    <!-- <script src="script.js"></script> -->
    <link rel="stylesheet" href="style.css">

</head>

<body>
    <div class="center container">
        <div class="card">
            <div class="card-header">
                <h3>Things To Do</h3>
            </div>
            <div class="card-body">
                <input type="text" class="hide" id="maininput" oninput="search()">
                <table id="itemtable" class="table"></table>
                <button id="addBtn" class="hide" onclick="addnew()">Add</button>
                <div class="row">
                    <div class="col-3">
                        <button class="btn btn-primary" id="addNew" onclick="showInput()"><i class="bi bi-plus-lg"></i></button>
                        <button class="btn btn-primary" id="search" onclick="showInput()"><i class="bi bi-search"></i></button>

                    </div>
                    <div class="col-2">
                        Total Records : <span id="totalSpan"></span>
                    </div>
                    <select id="btnSort" class="col-4" onchange="sortList(this.value)">
                    <option value="0" disabled selected>Sort</option>
                    <option value="1">Name A To Z</option>
                    <option value="2">Name Z To A</option>
                    <option value="3">Time Ascending</option>
                    <option value="4">Time Descending</option>
                </select>
                    <div class="col-3">
                        <button class="btn btn-primary" id="btnAll" onclick="checkAll()">All</button>
                        <button class="btn btn-primary" id="btnActive" onclick="active()">Active</button>
                        <button class="btn btn-primary" d="btnComplited" onclick="inactive()">Complited</button>
                    </div>
                </div>


            </div>
        </div>
    </div>

</body>
<script>
    let list = [];
    (function() {
        if (localStorage.getItem('todoList') != null && localStorage.getItem('todoList') != '') {
            list = JSON.parse(localStorage.todoList);
        } else {
            localStorage.setItem('todoList', JSON.stringify(list))
        }
        setUl(list);
    })();

    function getCurrentDate() {
        return new Date().toLocaleString();
    }

    function updateLocalList() {
        localStorage.setItem('todoList', JSON.stringify(list))
        setUl(list);
    }

    function setUl(showList) {
        let html = '';
        showList.forEach(function(item, index) {
            html += `<tr>
        <td class='tdCheckbox'><input type="checkbox" class="editRecord" value="${index}"></td>
        <td class='hide' id=${'div' + index}>  <input type="text" id="item${index}" value='${item.name}' class='editnput'> <button onclick='update(${index})'>Edit</button></td>
        <td class='itemName ${item.status != 'active' ? 'overLine' : ''}' id='td${index}'>${item.name}</td>
        <td class='itemName' >${item.time}</td>
        <td class='row width10'>
          <button class="btn btn-info col-5" onclick='editItem(${index})'><span class="bi bi-pen"></span></button><button class="btn btn-danger col-5" onclick='removeItem(${index})'><i class="bi bi-x-square"></i></button></td>
        
        </tr> `;
        });
        document.getElementById('itemtable').innerHTML = html;
        document.getElementById('totalSpan').innerText = list.length;
    }

    function editItem(id) {
        document.getElementById('td' + id).classList.toggle('hide')
        document.getElementById('div' + id).classList.toggle('hide')
    }

    function update(id) {
        list[id] = document.getElementById('item' + id).value;
        localList();
        setUl(list);
    }

    function removeItem(id) {
        list.splice(id, 1);
        updateLocalList();
        setUl(list);
    }

    function search() {
        let inputval = document.getElementById('maininput').value;
        let newList = [];
        list.forEach(function(item, index) {
            if (item.name.indexOf(inputval) != -1) {
                newList.push({
                    name: item.name
                })
            }
        });
        if (!newList.length) {
            newList.push({
                name: 'No Record Found.',
                time: '',
                status: 'active',
            });
            document.getElementById('addBtn').classList.remove('hide')
        }
        setUl(newList);
    }

    function addnew() {
        let item = document.getElementById('maininput').value;
        if (!list.includes(item)) {
            list.push({
                name: item,
                time: getCurrentDate(),
                status: 'active',
            });
        } else {
            alert('Allrady in List')
        }
        updateLocalList();
        setUl(list);
    }

    function sortList(id) {
        if (id == 1) {
            list.sort((a, b) => (a.name > b.name) ? 1 : -1);
        } else if (id == 2) {
            list.reverse((a, b) => (a.name > b.name) ? 1 : -1);
        } else if (id == 3) {
            list.sort((a, b) => (a.tiem > b.time) ? 1 : -1);
        } else if (id == 4) {
            list.reverse((a, b) => (a.tiem > b.time) ? 1 : -1);
        }
        setUl(list);
    }

    function checkAll() {
        check = document.querySelectorAll('input[type=checkbox]');
        check.forEach(function(checkbox) {
            checkbox.checked = true;
        })
    }

    function active() {
        check = document.querySelectorAll('input[type=checkbox]:checked');
        check.forEach(function(chk) {
            list[chk.value].status = 'active'
        })
        updateLocalList();
    }

    function inactive() {
        check = document.querySelectorAll('input[type=checkbox]:checked');
        check.forEach(function(chk) {
            list[chk.value].status = 'inactive'
        })
        updateLocalList();
    }

    function showInput() {
        document.getElementById('maininput').classList.toggle('hide')
    }
</script>

</html>